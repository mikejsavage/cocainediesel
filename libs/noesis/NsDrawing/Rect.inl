////////////////////////////////////////////////////////////////////////////////////////////////////
// NoesisGUI - http://www.noesisengine.com
// Copyright (c) 2013 Noesis Technologies S.L. All Rights Reserved.
// [CR #868]
////////////////////////////////////////////////////////////////////////////////////////////////////


#include <NsCore/Error.h>
#include <NsDrawing/Size.h>
#include <NsDrawing/Point.h>
#include <NsMath/Utils.h>

#include <limits>


namespace Noesis
{

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect::Rect(float left, float top, float right, float bottom): x(left), y(top), 
    width(right - left), height(bottom - top)
{
    NS_ASSERT(left <= right);
    NS_ASSERT(top <= bottom);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect::Rect(const Size& size): x(0.0f), y(0.0f), width(size.width), height(size.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect::Rect(const Point& location, const Size& size): x(location.x), y(location.y),
    width(size.width), height(size.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect::Rect(const Recti& rect):
    x(static_cast<float>(rect.x)), y(static_cast<float>(rect.y)),
    width(static_cast<float>(rect.width)), height(static_cast<float>(rect.height))
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect::Rect(const Rect& rect): x(rect.x), y(rect.y), width(rect.width), height(rect.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect& Rect::operator=(const Rect& rect)
{
    x = rect.x;
    y = rect.y;
    width = rect.width;
    height = rect.height;

    return *this;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::operator==(const Rect& rect) const
{
    return x == rect.x && y == rect.y && width == rect.width && height == rect.height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::operator!=(const Rect& rect) const
{
    return !(*this == rect);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Point Rect::GetLocation() const
{
    return Point(x, y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::SetLocation(const Point& location)
{
    x = location.x;
    y = location.y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Size Rect::GetSize() const
{
    return Size(width, height);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::SetSize(const Size& size)
{
    width = size.width;
    height = size.height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Rect::GetLeft() const
{
    return x;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Rect::GetRight() const
{
    return IsInfinity(width) ? std::numeric_limits<float>::infinity() : x + width;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Rect::GetTop() const
{
    return y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Rect::GetBottom() const
{
    return IsInfinity(height) ? std::numeric_limits<float>::infinity() : y + height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Point Rect::GetTopLeft() const
{
    return Point(x, y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Point Rect::GetTopRight() const
{
    return Point(GetRight(), y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Point Rect::GetBottomLeft() const
{
    return Point(x, GetBottom());
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Point Rect::GetBottomRight() const
{
    return Point(GetRight(), GetBottom());
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::IsEmpty() const
{
    return width == 0.0f || height == 0.0f;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::Contains(float x_, float y_) const
{
    return !IsEmpty() &&
        x_ >= GetLeft() && x_ <= GetRight() &&
        y_ >= GetTop() && y_ <= GetBottom();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::Contains(const Point& point) const
{
    return Contains(point.x, point.y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::Contains(const Rect& rect) const
{
    return !IsEmpty() && !rect.IsEmpty() && 
        rect.GetLeft() >= GetLeft() && rect.GetRight() <= GetRight() &&
        rect.GetTop() >= GetTop() && rect.GetBottom() <= GetBottom();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Inflate(float width_, float height_)
{
    x -= width_;
    y -= height_;
    width += 2.0f * width_;
    height += 2.0f * height_;

    if (width <= 0.0f || height <= 0.0f)
    {
        x = 0.0f;
        y = 0.0f;
        width = 0.0f;
        height = 0.0f;
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Inflate(const Size& size)
{
    Inflate(size.width, size.height);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Rect::IntersectsWith(const Rect& rect) const
{
    const float eps = std::numeric_limits<float>::epsilon();
    Size s = Intersect(rect).GetSize();
    return s.width > eps && s.height > eps;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Offset(const Point& offset)
{
    x += offset.x;
    y += offset.y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Scale(float scaleX, float scaleY)
{
    width *= scaleX;
    height *= scaleY;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Expand(const Point& point)
{
    float x0 = Min(x, point.x);
    float y0 = Min(y, point.y);
    float x1 = Max(GetRight(), point.x);
    float y1 = Max(GetBottom(), point.y);

    x = x0;
    y = y0;
    width = x1 - x0;
    height = y1 - y0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Rect::Expand(const Rect& rect)
{
    float x0 = Min(x, rect.x);
    float y0 = Min(y, rect.y);
    float x1 = Max(GetRight(), rect.GetRight());
    float y1 = Max(GetBottom(), rect.GetBottom());

    x = x0;
    y = y0;
    width = x1 - x0;
    height = y1 - y0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect Rect::Empty()
{
    return Rect(0.0f, 0.0f, 0.0f, 0.0f);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Rect Rect::Infinite()
{
    const float inf = std::numeric_limits<float>::infinity();
    return Rect(-inf, -inf, inf, inf);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti::Recti(int left, int top, int right, int bottom): x(left), y(top), 
    width(right - left), height(bottom - top)
{
    NS_ASSERT(left <= right);
    NS_ASSERT(top <= bottom);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti::Recti(const Sizei& size): x(0), y(0), width(size.width), height(size.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti::Recti(const Pointi& location, const Sizei& size): x(location.x), y(location.y),
    width(size.width), height(size.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti::Recti(const Recti& rect): x(rect.x), y(rect.y), width(rect.width), height(rect.height)
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti& Recti::operator=(const Recti& rect)
{
    x = rect.x;
    y = rect.y;
    width = rect.width;
    height = rect.height;

    return *this;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::operator==(const Recti& rect) const
{
    return x == rect.x && y == rect.y && width == rect.width && height == rect.height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::operator!=(const Recti& rect) const
{
    return !(*this == rect);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Pointi Recti::GetLocation() const
{
    return Pointi(x, y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::SetLocation(const Pointi& location)
{
    x = location.x;
    y = location.y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Sizei Recti::GetSize() const
{
    return Sizei(width, height);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::SetSize(const Sizei& size)
{
    width = size.width;
    height = size.height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
int Recti::GetLeft() const
{
    return x;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
int Recti::GetRight() const
{
    return x + width;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
int Recti::GetTop() const
{
    return y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
int Recti::GetBottom() const
{
    return y + height;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Pointi Recti::GetTopLeft() const
{
    return Pointi(x, y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Pointi Recti::GetTopRight() const
{
    return Pointi(GetRight(), y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Pointi Recti::GetBottomLeft() const
{
    return Pointi(x, GetBottom());
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Pointi Recti::GetBottomRight() const
{
    return Pointi(GetRight(), GetBottom());
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::IsEmpty() const
{
    return width == 0 || height == 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::Contains(int x_, int y_) const
{
    return !IsEmpty() &&
        x_ >= GetLeft() && x_ <= GetRight() &&
        y_ >= GetTop() && y_ <= GetBottom();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::Contains(const Pointi& point) const
{
    return Contains(point.x, point.y);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::Contains(const Recti& rect) const
{
    return !IsEmpty() && !rect.IsEmpty() &&
        rect.GetLeft() >= GetLeft() && rect.GetRight() <= GetRight() &&
        rect.GetTop() >= GetTop() && rect.GetBottom() <= GetBottom();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Inflate(int width_, int height_)
{
    x -= width_;
    y -= height_;
    width += 2 * width_;
    height += 2 * height_;

    if (width <= 0.0f || height <= 0.0f)
    {
        x = 0;
        y = 0;
        width = 0;
        height = 0;
    }
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Inflate(const Sizei& size)
{
    Inflate(size.width, size.height);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Recti::IntersectsWith(const Recti& rect) const
{
    Sizei s = Intersect(rect).GetSize();
    return s.width > 0 && s.height > 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Offset(const Pointi& offset)
{
    x += offset.x;
    y += offset.y;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Scale(int scaleX, int scaleY)
{
    width *= scaleX;
    height *= scaleY;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Expand(const Pointi& point)
{
    int x0 = Min(x, point.x);
    int y0 = Min(y, point.y);
    int x1 = Max(GetRight(), point.x);
    int y1 = Max(GetBottom(), point.y);

    x = x0;
    y = y0;
    width = x1 - x0;
    height = y1 - y0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Recti::Expand(const Recti& rect)
{
    int x0 = Min(x, rect.x);
    int y0 = Min(y, rect.y);
    int x1 = Max(GetRight(), rect.GetRight());
    int y1 = Max(GetBottom(), rect.GetBottom());

    x = x0;
    y = y0;
    width = x1 - x0;
    height = y1 - y0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti Recti::Empty()
{
    return Recti(0, 0, 0, 0);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Recti Recti::Infinite()
{
    const int inf = std::numeric_limits<int>::infinity();
    return Recti(-inf, -inf, inf, inf);
}

}
